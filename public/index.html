<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Event Social</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="./base.css">
    <link rel="stylesheet" type="text/css" href="./style.css">
</head>

<body>
    
    <section id="nav" class="hide">
        <div class="content main-nav">
            <h1 class="nav-title">Event Social Creator</h1>

            <div class="options">
                <div class="event-list-wrapper">
                  <p class="option-title">Your Events: </p>
                  <select class="input" events-list>
                    
                  </select>
                </div>
               

                <button analyze-new-event class="button button-glared">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg>
                  <span>Analyze New Event</span>
                </button>
            </div>
        </div>
    </section>

    <section id="url-screen">
        <img src="./back.png" class="back">
        <div class="content">

            <h2 class="title">
               Transform Your Event into Viral Posts
            </h2>
            <p class="description text">
                Paste your event website URL and let AI create a complete Instagram marketing campaign.
            </p>

            <div class="input-card">
                <form id="event-url-form">
                  <input class="input" type="text" id="event-url-input" placeholder="www.your-event-website.com">

                  <button analyze-url-btn class="button button-glared">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg>
                    <span>Analyze Event & Generate Posts</span>
                  </button>
                </form>
            </div>
        </div>
    </section>

    <section id="fetching-screen">
        <img src="./back.png" class="back">
        <div class="content">
            <div class="loading-card">
                <h2 class="title">
                   Event web is being analyzed...
                </h2>
                <div class="progress-bar">
                  <div class="progress-bar-inner"></div>
                </div>
            </div>
        </div>
    </section>
   
   <section id="post-editor" class="">
       
       <div class="content">
           <button class="close button button-secondary" close>X</button>
           <div class="wrapper">
               
           </div>
       </div>
   </section>

   <div class="section-wrapper">
        
        <div id="side-nav" class="hide">
              <div class="title-holder">
                 <h2 class="title">
                   Your Social Campaign:
                 </h2>
              </div>
              <div class="info-holder">
                 <a class="event-url link" event-url="" href="" target="_blank">Event Url</a>

                 <p class="text info">Days Until Event: <span days-until-event="">31</span></p>

                 <!-- <p class="text info">Event Date: <span event-date="">2025-10-27</span></p> -->
                 <form>
                   <p class="text info">Event Name: </p>
                   <input event-name type="text" class="input" value="">

                   <p class="text info">Event Date: </p>
                   <input event-date type="date" class="input" value="">


                   <button update-data class="button button-glared">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon"><path d="M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z"></path><path d="M20 3v4"></path><path d="M22 5h-4"></path><path d="M4 17v2"></path><path d="M5 18H3"></path></svg>
                     <span>Update Data</span>
                   </button>

                 </form>
                 
              </div>
            </div>


        </div>

    <section id="posts-screen">
        <div class="content">
            <div class="top-bar">
                <div class="title-holder">
                   <h3 class="posts-content-title">
                     AI Generated Posts List (<span posts-generated="">8</span>): 
                   </h3>
                </div>
            </div>
            <div class="posts-content">
              <div class="posts-wrapper">
                
              </div>
            </div>
        </div>
    </section>
    

      

    
    </div>

    <img id="image-testing">

</body>

</html>

<script>
    const EventSocialManager = {
        state: {
            currentEvent:{
              webData: null,
              screenshot: null,
              eventData: null,
              posts: [],
              tempPosts: [],
              currentPost: null,
              url: null,
              uid: '',
            },

            events:[],
        },

        elements: {}, 

        async init() {
            this.showScreen('url-screen');
            this.setElements();
            this.bindEvents();

            this.checkStorage();
        },

        setElements() {
            this.elements = {
                urlScreen: document.querySelector('#url-screen'),
                analyzeUrlForm: document.querySelector('#event-url-form'),
                urlInput: document.querySelector('#event-url-input'),
                analyzeUrlBtn: document.querySelector('[analyze-url-btn]'),

                fetchingScreen: document.querySelector('#fetching-screen'),
                
                postsHolder: document.querySelector('#posts-screen .posts-wrapper'),


                postsGeneratedEls: document.querySelectorAll('[posts-generated]'),
                eventDate: document.querySelector('[event-date]'),
                daysUntilEventEls: document.querySelectorAll('[days-until-event]'),
                eventName: document.querySelector('[event-name]'),
                eventUrlEls: document.querySelectorAll('[event-url]'),
                updateDataBtn: document.querySelector('[update-data]'),

                postEditorEl: document.querySelector('#post-editor'),
                postEditorClose: document.querySelector('#post-editor .close'),

                tabButtonsEls: document.querySelectorAll('[tab-btn]'),
                eventsListEl: document.querySelector('[events-list]'),

                newEventBtn: document.querySelector('[analyze-new-event]'),
            } 
        },

        bindEvents() {
            this.elements.analyzeUrlForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const url = this.elements.urlInput.value;
                if (url) {
                    this.fetchAllData(url);
                } else {
                    console.log('Please enter a valid URL.');
                }
            });
            

            this.elements.postsHolder.addEventListener('click', (e) => {
                const post = e.target.closest('[post-card]');
                if (post) {
                    let id = post.getAttribute('post-card');
                    this.openPost(id);
                }
            });
            this.elements.postEditorClose.addEventListener('click',()=>{
                this.elements.postEditorEl.classList.remove('open');
            });


            this.elements.updateDataBtn.addEventListener('click',(e)=>{
                e.preventDefault();
                this.updateEventData();
            });

            

            this.elements.eventsListEl.addEventListener('change',()=>{
                  this.selectEvent();
            });


            this.elements.newEventBtn.addEventListener('click',()=>{
                 this.analyzeNewEvent();
            });
            
            // window.addEventListener('beforeunload', () => {
            //     navigator.sendBeacon('/api/end-session', new Blob());
            // });
        },


        async fetchApi(endpoint, options = {}) {
            try {
                options.credentials = 'include'; 

                const response = await fetch(endpoint, options);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({
                        error: 'An unknown server error occurred.'
                    }));
                    throw new Error(errorData.error || `Server responded with status: ${response.status}`);
                }
                return response.json();
            } catch (error) {
                console.error(`Failed to fetch ${endpoint}:`, error);
                throw error;
            }
        },


        async fetchAllData(url) {
            this.showScreen('fetching-screen');
            this.state.currentEvent.url = url;
            console.log(`Fetching data for: ${url}`);

            this.setLoadingProgress(2);
        
            try {
                
                await this.getWebData();
                this.setLoadingProgress(4);

                await this.getEventData();
                this.setLoadingProgress(7);

                await this.getPosts();

                
                this.renderPosts();

                console.log('posts rendered');

                // Transition the UI to the results screen
                const screen = document.querySelector('#fetching-screen');
                screen.classList.add('end-loading');

                this.renderData();
                
                let uid = this.generateUniqueCode();
                
                this.state.currentEvent.uid = uid;

                this.state.events.push({
                  uid: uid,
                  eventData: this.state.currentEvent,
                });

                

                setTimeout(() => {
                    this.showScreen('posts-screen');
                }, 1000);

                let imageUrl = this.state.currentEvent.screenshot;

                await this.saveImageByUrl(imageUrl);
                this.state.currentEvent.screenshot = this.getImageName(imageUrl);

                this.saveData('full_state_data', this.state);
        
            } catch (error) {
                // --- Failure Path ---
                console.error("Data fetch failed:", error.message);
            }
        },


        async getWebData(){
            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'web_data',
                                       webData: null })
            });
        
            console.log("Web Data received");
        
            // Update state with the new data
            this.state.currentEvent.webData = response.html;
            this.state.currentEvent.screenshot = response.screenshot;
        },
        async getEventData(){
            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'event_data', 
                                       webData: this.state.currentEvent.webData })
            });
        
            console.log("Event Data received:", response);
        
            // Update state with the new data
            this.state.currentEvent.eventData = response;
        },
        async getPosts(){
            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'posts', 
                                       webData: JSON.stringify(this.state.currentEvent.eventData) })
            });
        
            console.log("Posts received:", response);
        
            // Update state with the new data
            this.state.currentEvent.posts = response;
        },

        async getRemadePosts(){

            let newData = {
                eventData: this.state.eventData,
                posts: this.state.posts,
            }

            newData.posts.forEach(post=>{
                post.date = null;
            })

            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'posts_remake', 
                                       webData: JSON.stringify(newData) })
            });
        
            console.log("Remake Posts received:", response);
        
            // Update state with the new data
            this.state.currentEvent.posts = response;
        },

        
        async getPostImage(){
            
            
            let postData = {
                post: this.state.currentEvent.currentPost,
                imageUrl: this.state.currentEvent.screenshot, 
                eventName: this.state.currentEvent.eventData.eventName,
                eventDate: this.state.currentEvent.eventData.eventDate,
            }

            console.log(postData);

            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'post_image', 
                                       webData: JSON.stringify(postData) })
            });
        
            console.log("Image Received:", response);
        
            

            let imageSaved = await this.saveImageByData(response.postImage, this.getUUID());

            // Update state with the new data
            this.state.currentEvent.currentPost.image = imageSaved.url;

            this.state.currentEvent.posts.forEach(post => {
              if(post.id == postData.post.id){
                 post.image = imageSaved.url;                 
              }
            });

            this.renderPosts();
        },


        async updateEventData(){
           this.saveData('full_state_data',this.state);

           this.state.currentEvent.tempPosts.push(this.state.currentEvent.posts);


           
           this.state.currentEvent.eventData.eventName = this.elements.eventName.value;
           this.state.currentEvent.eventData.eventDate = this.elements.eventDate.value;
           
           this.showScreen('fetching-screen');
           const screen = document.querySelector('#fetching-screen');
           screen.classList.remove('end-loading');

           this.setLoadingProgress(2);
        
           try {
                await this.getPosts();
                this.setLoadingProgress(3);

                setTimeout(() => {
                   this.setLoadingProgress(5); 
                });
                
                this.renderPosts();

                console.log('posts rendered');

                // Transition the UI to the results screen
                const screen = document.querySelector('#fetching-screen');
                screen.classList.add('end-loading');

                this.renderData();

                setTimeout(() => {
                    this.showScreen('posts-screen');
                }, 1000);
        
            } catch (error) {
                // --- Failure Path ---
                console.error("Data fetch failed:", error.message);

                // Transition the UI to the results screen
                const screen = document.querySelector('#fetching-screen');
                screen.classList.add('end-loading');

                this.renderData();

                setTimeout(() => {
                    this.showScreen('posts-screen');
                }, 1000);
            }
        },

        selectEvent(){
          let eventUID = this.elements.eventsListEl.value;
          let selectedEvent = this.state.events.filter(event => event.uid === eventUID); 
          console.log(eventUID);
          console.log(selectedEvent[0].eventData);

          this.state.currentEvent = selectedEvent[0].eventData;

          this.renderData();
          this.renderPosts();
        },

        
        async saveImageByUrl(imageUrl){

            let newImageData = null;
            try {
              let imageBlob = await this.urlStringToBlob(imageUrl);

              newImageData = await this.encodeLocalImage(imageBlob);
            } catch (error) {
              console.error("Image processing error:", error);
              return;
            }

            newImageData['name'] = this.getImageName(imageUrl);

            console.log(newImageData);

            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'save_image', 
                                       webData: JSON.stringify(newImageData) })
            });
        },
        async saveImageByData(imageData,name){

            imageData['name'] = name;

            console.log(imageData);

            const response = await this.fetchApi('/api/analyze', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ url: this.state.currentEvent.url, 
                                       request: 'save_image', 
                                       webData: JSON.stringify(imageData) })
            });

            return response;
        },

        analyzeNewEvent(){
            this.showScreen('url-screen');
            const screen = document.querySelector('#fetching-screen');
            screen.classList.remove('end-loading');

            // this.openTab(document.querySelector('[tab-btn="social-campaign"]'));
        },


        // --- UI RENDERING ---
        showScreen(screenName) { 
            let screens = document.querySelectorAll('section');
            screens.forEach(screen=>{
              screen.classList.add('hide');
            });

            let screen = document.querySelector(`#${screenName}`);
            screen.classList.remove('hide');

            if(screenName == 'fetching-screen'){
                screen.classList.add('loading');
            }

            if(screenName == 'posts-screen'){
                 document.querySelector('#nav').classList.remove('hide');
                 document.querySelector('#side-nav').classList.remove('hide');
            }
        },

        openPost(id){
           let post = document.querySelector(`[post-card="${id}"]`);
           this.elements.postEditorEl.classList.add('open');
           let inner = this.elements.postEditorEl.querySelector('.wrapper');
           inner.innerHTML = post.innerHTML;
           

           // PLACeHOLDER
           let postData = this.currentEvent.posts[0];

           this.currentEvent.currentPost = postData;
        },



        setLoadingProgress(val){
           this.elements.fetchingScreen.setAttribute('progress',val);
        },


        renderPosts(){
            let html = ``;

            this.elements.postsHolder.innerHTML = html;

            this.state.currentEvent.posts.forEach((post,key)=>{
                let imageUrl = post.image;
                html += `
                    <div class="post-card" post-card="${key}">
                        <div class="bar">
                            <p class="type" type="${post.type}">${post.type.replace('_',' ')}</p>
                            <p class="date">posting date: <span>${post.date}</span></p>
                        </div>

                        <div class="img-holder">
                           <img src="${imageUrl}" width="100%" height="100%">
                        </div>
                        <h3 class="post-title">${post.title}</h3>
                        <p class="post-content">${post.content}</p>
                        <div class="hashtags">
                            ${post.hashtags.map(hashtag => {
                                return `<p class="hashtag">${hashtag}</p>`;
                            }).join('')} 
                        </div>
                    </div>
                `;
            });

            this.elements.postsHolder.innerHTML = html;
        },

        renderData(){
            this.elements.postsGeneratedEls.forEach(el=>{
               el.innerHTML = this.state.currentEvent.posts.length;
            });

            this.elements.eventDate.value = this.state.currentEvent.eventData.eventDate;
            
            this.elements.eventName.value = this.state.currentEvent.eventData.eventName;


            this.elements.daysUntilEventEls.forEach(el=>{
               el.innerHTML = this.getDaysUntil(this.state.currentEvent.eventData.eventDate);
            });

            

            this.elements.eventUrlEls.forEach(el=>{
               el.href = this.state.currentEvent.url;
            });
        },

        renderEvents(){
            let events = '';
            this.state.events.forEach(event=>{
                 events += `
                    <option class="event-item" 
                       value="${event.uid}" 
                       ${(this.state.currentEvent.uid == event.uid)? ' selected' : ''} >
                         ${event.eventData.eventData.eventName}
                    </option>
                 `;
            });
            this.elements.eventsListEl.innerHTML = events;
        },
 
       

        // saving and loading
        checkStorage(){
           let data = this.loadData('full_state_data');
           if(data == null){
             return;
           }
           
           this.state = data;

           if(!this.state.currentEvent.uid){
             this.state.currentEvent = this.state.events[0].eventData;
           }

           this.showScreen("posts-screen");
           this.renderPosts();
           this.renderData();
           this.renderEvents();
        },
        saveData(key, data) {
            try {
                // Convert the JavaScript object into a JSON string before saving.
                const serializedData = JSON.stringify(data);
                localStorage.setItem(key, serializedData);
                console.log(`Data saved successfully for key: ${key}`);
            } catch (error) {
                console.error("Error saving data to localStorage:", error);
            }
        },
        loadData(key) {
            try {
                const serializedData = localStorage.getItem(key);
                
                // Return null if no data is found for the key.
                if (serializedData === null) {
                    console.log(`No data found for key: ${key}`);
                    return null;
                }
                
                // Convert the JSON string back into a JavaScript object.
                return JSON.parse(serializedData);
            } catch (error) {
                console.error("Error retrieving or parsing data from localStorage:", error);
                return null;
            }
        },



        // misc
        generateUniqueCode() {
          // 1. Get the current Unix timestamp in milliseconds.
          const timestamp = Date.now();
          
          // 2. Convert the timestamp to a Base36 string (shorter, alphanumeric representation).
          const timeBase36 = timestamp.toString(36);
          
          // 3. Generate a small random component (using a character from a random Base36 string)
          // to ensure uniqueness when the function is executed in rapid succession.
          const randomComponent = Math.random().toString(36).substring(2, 3);
          
          // Combine time and a small random factor.
          return timeBase36 + randomComponent;
        },
        getDaysUntil(futureDateStr) {
         // Get today's date and set the time to the beginning of the day
         const today = new Date();
         today.setHours(0, 0, 0, 0);
       
         // Create a Date object for the future date
         const futureDate = new Date(futureDateStr);
       
         // Calculate the difference in milliseconds
         const timeDifference = futureDate.getTime() - today.getTime();
       
         // Convert milliseconds to days and round up
         const daysRemaining = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));
       
         return daysRemaining;
        },

        async encodeLocalImage(fileObject) {
            return new Promise((resolve, reject) => {
                
                if (!fileObject) {
                    return reject(new Error("No file object provided."));
                }
                
                if (!(fileObject instanceof Blob)) { 
                     return reject(new TypeError("Invalid input: Expected a File or Blob object."));
                }
        
                const mimeType = fileObject.type;
                const reader = new FileReader();
        
                reader.onload = () => {
                    const dataUrl = reader.result;
        
                    const base64Index = dataUrl.indexOf(',');
                    if (base64Index === -1) {
                        return reject(new Error("Could not parse file data URL."));
                    }
                    
                    const base64Data = dataUrl.substring(base64Index + 1);
        
                    resolve({
                        data: base64Data,
                        mimeType: mimeType
                    });
                };
        
                reader.onerror = (error) => {
                    reject(new Error(`Error reading file: ${error.target.error.name}`));
                };
        
                reader.readAsDataURL(fileObject);
            });
        },
        async urlStringToBlob(imageUrl) {
            if (!imageUrl || typeof imageUrl !== 'string') {
                throw new Error('Invalid URL string provided.');
            }
        
            try {
                console.log(`Fetching image from URL: ${imageUrl}`);
                
                // 1. Fetch the resource as a response stream
                const response = await fetch(imageUrl);
        
                if (!response.ok) {
                    throw new Error(`Failed to fetch image: Status ${response.status}`);
                }
        
               
                const imageBlob = await response.blob();
                
                return imageBlob;
        
            } catch (error) {
                console.error('Error converting URL to Blob:', error);
                throw new Error(`Could not process image URL: ${error.message}`);
            }
        },

        dataToUrl(imageData) {

            if(imageData?.data == null || imageData?.mymeType == null){
                return null;
            }

            const dataUrl = `data:${imageData?.mymeType};base64,${imageData?.data}`;
            
            return dataUrl;
        },

        getImageName(imageUrl) {
            if (!imageUrl || typeof imageUrl !== 'string') {
                return '';
            }
        
            const parts = imageUrl.split('/');
            let fileNameWithExtensionAndQuery = parts.pop() || '';

            if (fileNameWithExtensionAndQuery === '') {
                fileNameWithExtensionAndQuery = parts.pop() || '';
            }
        
            const fileWithExtension = fileNameWithExtensionAndQuery.split('?')[0];
        
            const lastDotIndex = fileWithExtension.lastIndexOf('.');
        
            if (lastDotIndex !== -1) {
                return fileWithExtension.substring(0, lastDotIndex);
            }
            
            return fileWithExtension;
        },

        
        loadDummyData(){
           let data = {
   "currentEvent":{
      "webData":"",
      "eventData":{
         "currentDate":"2025-10-01",
         "eventDate":"2026-01-26",
         "eventName":"Friday show! - The Villain Comedy - standup showcase in English",
         "content":"[{\"event_name\":\"Friday show! - The Villain Comedy - standup showcase in English\",\"location\":{\"venue_name\":\"Xafarix\",\"address\":\"69 Avenida Dom Carlos I, 69, 1200-647 Lisboa, Portugal\"},\"organizer\":\"Standup Comedy Lisbon\",\"dates\":[{\"date\":\"2025-10-03\",\"start_time\":\"20:30\",\"end_time\":\"23:00\"}],\"entry_fee\":\"donation at the end, pay what you want\",\"description\":\"Let your laughters light up your weekend, in a gorgeous bar in the coolest area in town. Have a blast with a standup comedy showcase in English featuring the best acts from home and abroad!\",\"additional_info\":\"Doors open at 20:30, show starts at 21:00. RSVPs held until 20:45, first come first served!\"}]"
      },
      "posts":[
         {
            "id":1,
            "date":"2025-10-08",
            "title":"🎉 Announcing The Villain Comedy Night!",
            "content":"Join us for an unforgettable evening with 'The Villain Comedy - standup showcase in English' at Xafarix, Lisbon. Laugh your heart out with the best acts from home and abroad on January 26, 2026. Secure your spot now!",
            "image":"https://example.com/images/Xafarix.jpg",
            "hashtags":[
               "#TheVillainComedy",
               " #StandupShowcase",
               " #Lisbon"
            ],
            "type":"announcement",
            "status":"schedule"
         },
         {
            "id":2,
            "date":"2025-10-22",
            "title":"Venue Highlight: Xafarix Awaits!",
            "content":"Experience comedy in the beautiful Xafarix located at Avenida Dom Carlos I, 69. Enjoy an evening filled with laughter in one of Lisbon's coolest bars. Don't miss out!",
            "image":"https://example.com/images/Xafarix-Venue.jpg",
            "hashtags":[
               "#Xafarix",
               " #ComedyVenue",
               " #LisbonEvents"
            ],
            "type":"venue",
            "status":"schedule"
         },
         {
            "id":3,
            "date":"2025-11-05",
            "title":"⭐ Meet Our Comedic Stars",
            "content":"Our lineup features top-notch comedians from both home and abroad, guaranteed to make you laugh till you drop! Keep an eye out for our next post introducing our stars.",
            "image":"https://example.com/images/ComediansLineup.jpg",
            "hashtags":[
               "#ComedyStars",
               " #StandupShowcase",
               " #LisbonComedy"
            ],
            "type":"speaker",
            "status":"schedule"
         },
         {
            "id":4,
            "date":"2025-11-19",
            "title":"🎭 What To Expect: Comedy Gold!",
            "content":"Be ready for an evening of unmatched humor and fun at 'The Villain Comedy' standup showcase. It's laughter and entertainment at its best!",
            "image":"https://example.com/images/ComedyShowcase.jpg",
            "hashtags":[
               "#ComedyGold",
               " #Standup",
               " #TheVillainComedy"
            ],
            "type":"activity",
            "status":"schedule"
         },
         {
            "id":5,
            "date":"2025-12-03",
            "title":"⏰ Save The Date: January 26!",
            "content":"Mark your calendars and get ready to join us at Xafarix for a night of laughter with 'The Villain Comedy' showcase. It's a first-come, first-served event, so arrive early!",
            "image":"https://example.com/images/SaveTheDate.jpg",
            "hashtags":[
               "#SaveTheDate",
               " #ComedyNights",
               " #Lisbon"
            ],
            "type":"urgency",
            "status":"schedule"
         },
         {
            "id":6,
            "date":"2025-12-17",
            "title":"🎟️ Pay What You Want!",
            "content":"Enjoy 'The Villain Comedy' and pay what you want. It's our way of saying everyone deserves a good laugh! Join us on January 26 and donate as you wish.",
            "image":"https://example.com/images/PayWhatYouWant.jpg",
            "hashtags":[
               "#PayWhatYouWant",
               " #StandupShowcase",
               " #ComedyForAll"
            ],
            "type":"announcement",
            "status":"schedule"
         },
         {
            "id":7,
            "date":"2026-01-10",
            "title":"Get Ready for Comedy Night!",
            "content":"Just a few weeks to go before 'The Villain Comedy' hits the stage at Xafarix. RSVP now and enjoy the best comedic acts! Doors open at 20:30.",
            "image":"https://example.com/images/ComedyNightPrep.jpg",
            "hashtags":[
               "#ComedyNight",
               " #RSVPNow",
               " #StandupShowcase"
            ],
            "type":"urgency",
            "status":"schedule"
         },
         {
            "id":8,
            "date":"2026-01-20",
            "title":"Final Countdown to Laughter!",
            "content":"We are just days away from 'The Villain Comedy' night. Join us at Xafarix for an unforgettable experience. Remember, first come, first served!",
            "image":"https://example.com/images/FinalCountdown.jpg",
            "hashtags":[
               "#CountdownToLaughs",
               " #StandupShowcase",
               " #LisbonComedy"
            ],
            "type":"urgency",
            "status":"schedule"
         },
         {
            "id":9,
            "date":"2026-01-25",
            "title":"😄 Comedy Show Tomorrow!",
            "content":"Get ready! Tomorrow is the big night at Xafarix. Make sure to arrive before 20:45 for the best seats. Can't wait to see you there!",
            "image":"https://example.com/images/GetReady.jpg",
            "hashtags":[
               "#ComedyTomorrow",
               " #TheVillainComedy",
               " #Lisbon"
            ],
            "type":"reminder",
            "status":"schedule"
         },
         {
            "id":10,
            "date":"2026-01-26",
            "title":"🎤 It's Showtime!",
            "content":"Tonight's the night for 'The Villain Comedy' standup showcase! Join us at Xafarix. Doors open at 20:30, with the show starting at 21:00. Let's laugh the night away!",
            "image":"https://example.com/images/Showtime.jpg",
            "hashtags":[
               "#Showtime",
               " #TheVillainComedy",
               " #Xafarix"
            ],
            "type":"event_day",
            "status":"schedule"
         },
         {
            "id":11,
            "date":"2026-01-27",
            "title":"🙏 Thank You for Joining Us!",
            "content":"A big thank you to everyone who attended 'The Villain Comedy' at Xafarix. We hope you had as much fun as we did. See you next time! 🎉",
            "image":"https://example.com/images/ThankYou.jpg",
            "hashtags":[
               "#ThankYou",
               " #TheVillainComedy",
               " #Lisbon"
            ],
            "type":"thank_you",
            "status":"schedule"
         }
      ],
      "tempPosts":[
         
      ],
      "currentPost":null,
      "url":"https://www.eventbrite.pt/e/friday-show-the-villain-comedy-standup-showcase-in-english-tickets-773302106417",
      "uid": "mg84p49gn",
   },
   "events":[
      {
         "uid":"mg7pjfmxr",
         "eventData":{
            "webData":"",
            "eventData":{
               "currentDate":"2025-10-01",
               "eventDate":"2025-10-27",
               "eventName":"RSRV x SOUL",
               "content":"[{\"eventTitle\":\"An Evening with Paintvine\",\"organizers\":\"Liv Carter & The Mumm RSRV Club\",\"eventDetails\":\"Join us for our 5th Mumm RSRV Club event - an interactive evening to showcase your artistic flare whilst enjoying the best of RSRV. We will showcase the new vintage release of the Blanc de Noirs 2012 and the Blanc de Blancs 2015, along with the first view of the new bottle design.\",\"date\":\"Thursday 27th October\",\"time\":\"4pm – 8pm\",\"location\":\"The Boat Shed Ōrakei, 1 Ngapipi Rd, Ōrakei.\",\"newVintageAlert\":\"We'll be showcasing the new vintage RSRV Blanc de Noirs 2012 with aromas of apricots and toasted brioche, aged for six years in our Maison Mumm cellars. This cuvée is available on the Henry & Paul site with limited allocation. The new vintage RSRV Blanc de Blancs 2015 is expected by the end of the year for Christmas gifting, in the new clear glass bottle, showcasing the golden hue of this 100% Chardonnay cuvée.\",\"birthdayTreat\":\"Update your birthday and address on the RSRV Club Henry & Paul page for a birthday treat.\",\"rsvpLink\":\"RSVP below.\"}]"
            },
            "posts":[
               {
                  "id":1,
                  "date":"2025-10-03",
                  "title":"🎨 Join Us at Paintvine's Evening!",
                  "content":"Don't miss our 5th Mumm RSRV Club event! Enjoy an interactive evening to showcase your artistic flair while sampling the finest RSRV vintages. Mark your calendars for October 27th! RSVP here: [RSVP link].",
                  "image":"https://example.com/images/Paintvine_Event.jpg",
                  "hashtags":[
                     "#Paintvine2025",
                     "#ArtAndWine",
                     "#Orakei"
                  ],
                  "type":"announcement",
                  "status":"schedule"
               },
               {
                  "id":2,
                  "date":"2025-10-10",
                  "title":"🍇 Discover Our New Vintage!",
                  "content":"Be among the first to taste the new RSRV Blanc de Noirs 2012 with aromas of apricots and toasted brioche. Aged to perfection, this wine promises a unique experience. Limited allocation available on Henry & Paul. RSVP now!",
                  "image":"https://example.com/images/RSRV_BlancDeNoirs2012.jpg",
                  "hashtags":[
                     "#RSRVWine",
                     "#LimitedEdition",
                     "#WineLovers"
                  ],
                  "type":"announcement",
                  "status":"schedule"
               },
               {
                  "id":3,
                  "date":"2025-10-17",
                  "title":"🎉 Early Bird Reminder!",
                  "content":"Our exclusive event is getting closer! Make sure you RSVP and update your details on the RSRV Club Henry & Paul page for a special birthday treat. Don’t miss out on this art and wine experience!",
                  "image":"https://example.com/images/EarlyBird.jpg",
                  "hashtags":[
                     "#ExclusiveEvent",
                     "#BirthdayTreat",
                     "#RSRVClub"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":4,
                  "date":"2025-10-20",
                  "title":"Venue Spotlight: The Boat Shed Ōrakei",
                  "content":"Join us at the stunning Boat Shed Ōrakei for our event. With picturesque views and an inspiring atmosphere, it’s the perfect backdrop for an unforgettable evening of art and wine. RSVP today!",
                  "image":"https://example.com/images/BoatShedOrakei.jpg",
                  "hashtags":[
                     "#OrakeiVenue",
                     "#EventSpotlight",
                     "#ArtAndWine"
                  ],
                  "type":"venue",
                  "status":"schedule"
               },
               {
                  "id":5,
                  "date":"2025-10-24",
                  "title":"⏰ Final Reminder: 3 Days to Go!",
                  "content":"The countdown is on! Only 3 days left until An Evening with Paintvine. Enjoy a celebration of art, wine, and community. Make sure you secure your spot before it's too late!",
                  "image":"https://example.com/images/Countdown.jpg",
                  "hashtags":[
                     "#PaintvineCountdown",
                     "#RSRVEvent",
                     "#FinalCall"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":6,
                  "date":"2025-10-26",
                  "title":"🎨 Last Chance to RSVP!",
                  "content":"Tomorrow's the day! Experience a blend of art and exquisite wines at our Mumm RSRV Club event. This is your final call to RSVP and be part of this exclusive gathering.",
                  "image":"https://example.com/images/LastChance.jpg",
                  "hashtags":[
                     "#RSRVLastCall",
                     "#ArtAndWineEvent",
                     "#MustAttend"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":7,
                  "date":"2025-10-27",
                  "title":"🎈 It's Event Day!",
                  "content":"The day is here! We’re excited to welcome you to The Boat Shed Ōrakei for an evening of creativity and fine wines. Let’s make memorable moments together. See you at 4 PM!",
                  "image":"https://example.com/images/EventDay.jpg",
                  "hashtags":[
                     "#PaintvineHappening",
                     "#CreativeEvening",
                     "#OrakeiEvent"
                  ],
                  "type":"event_day",
                  "status":"schedule"
               },
               {
                  "id":8,
                  "date":"2025-10-28",
                  "title":"🙏 Thank You for Joining Us!",
                  "content":"Thank you for being part of An Evening with Paintvine! We hope you enjoyed the art and wine experience as much as we did. Stay tuned for more events from Mumm RSRV Club!",
                  "image":"https://example.com/images/ThankYou.jpg",
                  "hashtags":[
                     "#ThankYou",
                     "#RSRVGratitude",
                     "#ArtAndWineMemories"
                  ],
                  "type":"thank_you",
                  "status":"schedule"
               }
            ],
            "tempPosts":[
               
            ],
            "currentPost":null,
            "url":"https://live.eventtia.com/en/soulrsrv"
         }
      },
      {
         "uid":"mg84p49gn",
         "eventData":{
            "webData":"",
            "eventData":{
               "currentDate":"2025-10-01",
               "eventDate":"2026-01-26",
               "eventName":"Friday show! - The Villain Comedy - standup showcase in English",
               "content":"[{\"event_name\":\"Friday show! - The Villain Comedy - standup showcase in English\",\"location\":{\"venue_name\":\"Xafarix\",\"address\":\"69 Avenida Dom Carlos I, 69, 1200-647 Lisboa, Portugal\"},\"organizer\":\"Standup Comedy Lisbon\",\"dates\":[{\"date\":\"2025-10-03\",\"start_time\":\"20:30\",\"end_time\":\"23:00\"}],\"entry_fee\":\"donation at the end, pay what you want\",\"description\":\"Let your laughters light up your weekend, in a gorgeous bar in the coolest area in town. Have a blast with a standup comedy showcase in English featuring the best acts from home and abroad!\",\"additional_info\":\"Doors open at 20:30, show starts at 21:00. RSVPs held until 20:45, first come first served!\"}]"
            },
            "posts":[
               {
                  "id":1,
                  "date":"2025-10-08",
                  "title":"🎉 Announcing The Villain Comedy Night!",
                  "content":"Join us for an unforgettable evening with 'The Villain Comedy - standup showcase in English' at Xafarix, Lisbon. Laugh your heart out with the best acts from home and abroad on January 26, 2026. Secure your spot now!",
                  "image":"https://example.com/images/Xafarix.jpg",
                  "hashtags":[
                     "#TheVillainComedy",
                     " #StandupShowcase",
                     " #Lisbon"
                  ],
                  "type":"announcement",
                  "status":"schedule"
               },
               {
                  "id":2,
                  "date":"2025-10-22",
                  "title":"Venue Highlight: Xafarix Awaits!",
                  "content":"Experience comedy in the beautiful Xafarix located at Avenida Dom Carlos I, 69. Enjoy an evening filled with laughter in one of Lisbon's coolest bars. Don't miss out!",
                  "image":"https://example.com/images/Xafarix-Venue.jpg",
                  "hashtags":[
                     "#Xafarix",
                     " #ComedyVenue",
                     " #LisbonEvents"
                  ],
                  "type":"venue",
                  "status":"schedule"
               },
               {
                  "id":3,
                  "date":"2025-11-05",
                  "title":"⭐ Meet Our Comedic Stars",
                  "content":"Our lineup features top-notch comedians from both home and abroad, guaranteed to make you laugh till you drop! Keep an eye out for our next post introducing our stars.",
                  "image":"https://example.com/images/ComediansLineup.jpg",
                  "hashtags":[
                     "#ComedyStars",
                     " #StandupShowcase",
                     " #LisbonComedy"
                  ],
                  "type":"speaker",
                  "status":"schedule"
               },
               {
                  "id":4,
                  "date":"2025-11-19",
                  "title":"🎭 What To Expect: Comedy Gold!",
                  "content":"Be ready for an evening of unmatched humor and fun at 'The Villain Comedy' standup showcase. It's laughter and entertainment at its best!",
                  "image":"https://example.com/images/ComedyShowcase.jpg",
                  "hashtags":[
                     "#ComedyGold",
                     " #Standup",
                     " #TheVillainComedy"
                  ],
                  "type":"activity",
                  "status":"schedule"
               },
               {
                  "id":5,
                  "date":"2025-12-03",
                  "title":"⏰ Save The Date: January 26!",
                  "content":"Mark your calendars and get ready to join us at Xafarix for a night of laughter with 'The Villain Comedy' showcase. It's a first-come, first-served event, so arrive early!",
                  "image":"https://example.com/images/SaveTheDate.jpg",
                  "hashtags":[
                     "#SaveTheDate",
                     " #ComedyNights",
                     " #Lisbon"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":6,
                  "date":"2025-12-17",
                  "title":"🎟️ Pay What You Want!",
                  "content":"Enjoy 'The Villain Comedy' and pay what you want. It's our way of saying everyone deserves a good laugh! Join us on January 26 and donate as you wish.",
                  "image":"https://example.com/images/PayWhatYouWant.jpg",
                  "hashtags":[
                     "#PayWhatYouWant",
                     " #StandupShowcase",
                     " #ComedyForAll"
                  ],
                  "type":"announcement",
                  "status":"schedule"
               },
               {
                  "id":7,
                  "date":"2026-01-10",
                  "title":"Get Ready for Comedy Night!",
                  "content":"Just a few weeks to go before 'The Villain Comedy' hits the stage at Xafarix. RSVP now and enjoy the best comedic acts! Doors open at 20:30.",
                  "image":"https://example.com/images/ComedyNightPrep.jpg",
                  "hashtags":[
                     "#ComedyNight",
                     " #RSVPNow",
                     " #StandupShowcase"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":8,
                  "date":"2026-01-20",
                  "title":"Final Countdown to Laughter!",
                  "content":"We are just days away from 'The Villain Comedy' night. Join us at Xafarix for an unforgettable experience. Remember, first come, first served!",
                  "image":"https://example.com/images/FinalCountdown.jpg",
                  "hashtags":[
                     "#CountdownToLaughs",
                     " #StandupShowcase",
                     " #LisbonComedy"
                  ],
                  "type":"urgency",
                  "status":"schedule"
               },
               {
                  "id":9,
                  "date":"2026-01-25",
                  "title":"😄 Comedy Show Tomorrow!",
                  "content":"Get ready! Tomorrow is the big night at Xafarix. Make sure to arrive before 20:45 for the best seats. Can't wait to see you there!",
                  "image":"https://example.com/images/GetReady.jpg",
                  "hashtags":[
                     "#ComedyTomorrow",
                     " #TheVillainComedy",
                     " #Lisbon"
                  ],
                  "type":"reminder",
                  "status":"schedule"
               },
               {
                  "id":10,
                  "date":"2026-01-26",
                  "title":"🎤 It's Showtime!",
                  "content":"Tonight's the night for 'The Villain Comedy' standup showcase! Join us at Xafarix. Doors open at 20:30, with the show starting at 21:00. Let's laugh the night away!",
                  "image":"https://example.com/images/Showtime.jpg",
                  "hashtags":[
                     "#Showtime",
                     " #TheVillainComedy",
                     " #Xafarix"
                  ],
                  "type":"event_day",
                  "status":"schedule"
               },
               {
                  "id":11,
                  "date":"2026-01-27",
                  "title":"🙏 Thank You for Joining Us!",
                  "content":"A big thank you to everyone who attended 'The Villain Comedy' at Xafarix. We hope you had as much fun as we did. See you next time! 🎉",
                  "image":"https://example.com/images/ThankYou.jpg",
                  "hashtags":[
                     "#ThankYou",
                     " #TheVillainComedy",
                     " #Lisbon"
                  ],
                  "type":"thank_you",
                  "status":"schedule"
               }
            ],
            "tempPosts":[
               
            ],
            "currentPost":null,
            "url":"https://www.eventbrite.pt/e/friday-show-the-villain-comedy-standup-showcase-in-english-tickets-773302106417"
         }
      }
   ]
           };

           this.state = data;

           this.showScreen("posts-screen");
           this.renderPosts();
           this.renderData();
           this.renderEvents();
        },

        loadImageData(src){
            document.querySelector('#image-testing').src = src;
        },


        getUUID() {
            const timeNow = Date.now();
            const randomPart1 = Math.floor(Math.random() * 0xFFFFFFFFFF).toString(16).padStart(10, '0');
            const randomPart2 = Math.floor(Math.random() * 0xFFFFFFFFFF).toString(16).padStart(10, '0');
            
            const timeHex = timeNow.toString(16).padStart(12, '0');
            const uuid = 
                timeHex.substring(0, 8) + '-' + 
                timeHex.substring(8, 12) + '-' + 
                '4' + randomPart1.substring(0, 3) + '-' + 
                'a' + randomPart1.substring(3, 6); 
            
            return uuid;
        },

    };

    document.addEventListener('DOMContentLoaded', () => {
        EventSocialManager.init();
    });
</script>



